import{k as e,j as a,r as s,o as t,D as l,a as r,c as n,b as o,e as c,f as d,t as i,g as u,m,w as p,p as g,F as y,h as x,x as v,y as b,J as f,H as w,n as k}from"./index-pv9O3sN3.js";import{l as h}from"./index-CUkmNz_4.js";const C={class:"min-h-screen py-8"},j={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},A={class:"card mb-8"},P={class:"flex items-center justify-between"},M={class:"flex items-center"},S={class:"text-2xl font-bold text-craftar-400"},I={class:"card"},_={key:0,class:"text-center py-12"},E={key:1,class:"space-y-4"},U={class:"flex items-center justify-between mb-4"},z={class:"text-lg font-semibold"},L={class:"text-gray-400 text-sm"},R={class:"text-right"},$={class:"text-xl font-bold text-craftar-400"},V={class:"mb-4"},q={class:"space-y-2"},B={class:"flex items-center"},D={class:"w-8 h-8 bg-gray-700 rounded mr-3 flex items-center justify-center flex-shrink-0"},O=["src","alt"],N={key:1,class:"fas fa-cube text-gray-500 text-xs"},H={class:"text-gray-400"},F={class:"mb-4"},G={class:"flex items-center justify-between text-sm"},J={class:"capitalize"},T={key:0,class:"flex items-center justify-between text-sm mt-1"},K={class:"text-gray-400"},Q={class:"text-craftar-400"},W={class:"flex items-center justify-between pt-4 border-t border-gray-700"},X={class:"flex items-center space-x-4"},Y={class:"text-sm text-gray-400"},Z={class:"flex items-center space-x-2"},ee=["onClick"],ae=["onClick"],se=["onClick"],te={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998]"},le={class:"bg-gray-800 rounded-lg p-6 w-full max-w-md"},re={class:"mb-4"},ne={class:"flex items-center justify-end space-x-3"},oe=["disabled"],ce={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9998]"},de={class:"bg-gray-800 rounded-lg p-6 w-full max-w-md"},ie={class:"mb-4"},ue={class:"space-y-3"},me={class:"flex items-center p-3 border border-gray-600 rounded-lg cursor-pointer hover:bg-gray-700"},pe={class:"flex items-center p-3 border border-gray-600 rounded-lg cursor-pointer hover:bg-gray-700"},ge={class:"text-sm text-gray-400"},ye={class:"flex items-center justify-end space-x-3"},xe=["disabled"],ve={__name:"Orders",setup(ve){const be=l(),fe=e(),we=a(),ke=s([]),he=s(0),Ce=s(!1),je=s(!1),Ae=s(""),Pe=s("mercadopago"),Me=s(null),Se=s(null),Ie=e=>({pending:"Pendiente",paying:"Pagando",paid:"Pagado",delivered:"Entregado",cancelled:"Cancelado",error:"Error"}[e]||e),_e=e=>({pending:"Esperando pago",paying:"Procesando pago",paid:"Pago confirmado",delivered:"Items entregados",cancelled:"Orden cancelada",error:"Error en el pago"}[e]||""),Ee=async()=>{try{const e=await w.get("/api/orders");ke.value=e.data}catch(e){console.error("Error loading orders:",e)}},Ue=async()=>{try{const e=await w.get("/api/wallet/balance");he.value=e.data.balance}catch(e){console.error("Error loading wallet balance:",e)}},ze=()=>{Ee(),Ue()},Le=async()=>{try{const e=await w.post(`/api/orders/${Me.value._id}/pay`,{paymentMethod:Pe.value,walletAmount:"wallet"===Pe.value?Me.value.totalAmount:null});"mercadopago"===Pe.value?window.open(e.data.paymentUrl,"_blank"):await ze(),je.value=!1,Me.value=null}catch(e){console.error("Error processing payment:",e),alert("Error al procesar el pago")}},Re=async()=>{try{const e=await w.post("/api/wallet/deposit",{amount:parseInt(Ae.value)});window.open(e.data.paymentUrl,"_blank"),Ce.value=!1,Ae.value=""}catch(e){console.error("Error processing deposit:",e),alert("Error al procesar la carga de saldo")}};return t(()=>{Ee(),Ue(),Se.value=h("https://cd2426bdec3d.ngrok-free.app"),Se.value.on("connect",()=>{console.log("Conectado al socket"),Se.value.emit("join-user-room",fe.user.id)}),Se.value.on("order-updated",e=>{console.log("Orden actualizada:",e);const a=ke.value.findIndex(a=>(a._id||a.id)===e.orderId);-1!==a&&(ke.value[a].status=e.status)}),Se.value.on("wallet-updated",e=>{console.log("Cartera actualizada:",e),he.value=e.newBalance,fe.updateBalance(e.newBalance)}),Se.value.on("coins-updated",e=>{console.log("Monedas actualizadas:",e),he.value=e.newBalance,fe.updateCoins(e.newCoins)}),"success"!==be.query.payment&&"approved"!==be.query.status||(we.clearCart(),console.log("Carrito limpiado después de compra exitosa"))}),r(()=>{Se.value&&(Se.value.emit("leave-user-room",fe.user.id),Se.value.disconnect())}),(e,a)=>{const s=g("router-link");return o(),n("div",C,[c("div",j,[a[21]||(a[21]=c("div",{class:"mb-8"},[c("h1",{class:"text-3xl font-bold gradient-text mb-2"}," Mis Órdenes "),c("p",{class:"text-gray-400"},"Gestiona tus compras y pagos")],-1)),c("div",A,[c("div",P,[c("div",M,[a[8]||(a[8]=c("div",{class:"w-12 h-12 bg-craftar-600 rounded-lg flex items-center justify-center mr-4"},[c("i",{class:"fas fa-wallet text-white text-xl"})],-1)),c("div",null,[a[7]||(a[7]=c("p",{class:"text-gray-400 text-sm"},"Saldo de Cartera",-1)),c("p",S," $"+i(he.value.toLocaleString("es-AR")),1)])]),c("button",{onClick:a[0]||(a[0]=e=>Ce.value=!0),class:"btn-primary"},[...a[9]||(a[9]=[c("i",{class:"fas fa-plus mr-2"},null,-1),u(" Cargar Saldo ",-1)])])])]),c("div",I,[c("div",{class:"flex items-center justify-between mb-6"},[a[12]||(a[12]=c("h2",{class:"text-xl font-semibold"},"Historial de Órdenes",-1)),c("div",{class:"flex items-center space-x-4"},[a[11]||(a[11]=c("div",{class:"flex items-center"},[c("div",{class:"w-3 h-3 bg-green-500 rounded-full mr-2"}),c("span",{class:"text-sm text-gray-400"},"Actualización automática")],-1)),c("button",{onClick:ze,class:"btn-secondary"},[...a[10]||(a[10]=[c("i",{class:"fas fa-sync-alt mr-2"},null,-1),u(" Actualizar ",-1)])])])]),0===ke.value.length?(o(),n("div",_,[a[14]||(a[14]=c("i",{class:"fas fa-shopping-cart text-6xl text-gray-600 mb-4"},null,-1)),a[15]||(a[15]=c("p",{class:"text-gray-400 mb-4"},"No tienes órdenes aún",-1)),m(s,{to:"/shop",class:"btn-primary"},{default:p(()=>[...a[13]||(a[13]=[c("i",{class:"fas fa-store mr-2"},null,-1),u(" Ir a la Tienda ",-1)])]),_:1})])):(o(),n("div",E,[(o(!0),n(y,null,x(ke.value,e=>{return o(),n("div",{key:e._id||e.id,class:"border border-gray-700 rounded-lg p-6"},[c("div",U,[c("div",null,[c("h3",z,"Orden #"+i(e._id?e._id.slice(-8):"N/A"),1),c("p",L,i((l=e.createdAt,l?new Date(l).toLocaleDateString("es-AR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A")),1)]),c("div",R,[c("p",$," $"+i(e.totalAmount.toLocaleString("es-AR")),1),c("span",{class:k([(t=e.status,{pending:"text-yellow-400",paying:"text-blue-400",paid:"text-green-400",delivered:"text-green-400",cancelled:"text-red-400",error:"text-red-400"}[t]||"text-gray-400"),"text-sm font-medium"])},i(Ie(e.status)),3)])]),c("div",V,[a[16]||(a[16]=c("h4",{class:"text-sm font-medium text-gray-400 mb-2"},"Items:",-1)),c("div",q,[(o(!0),n(y,null,x(e.items,e=>(o(),n("div",{key:e.productId._id,class:"flex items-center justify-between text-sm"},[c("div",B,[c("div",D,[e.productId.image?(o(),n("img",{key:0,src:e.productId.image,alt:e.productId.name,class:"w-full h-full object-cover rounded",onError:a[1]||(a[1]=e=>{e.target.style.display="none"})},null,40,O)):(o(),n("i",N))]),c("span",null,i(e.productId.name)+" x"+i(e.quantity),1)]),c("span",H,"$"+i((e.price*e.quantity).toLocaleString("es-AR")),1)]))),128))])]),c("div",F,[c("div",G,[a[17]||(a[17]=c("span",{class:"text-gray-400"},"Método de pago:",-1)),c("span",J,i((s=e.paymentMethod,{mercadopago:"MercadoPago",wallet:"Cartera",coins:"Monedas"}[s]||s)),1)]),e.walletAmountUsed>0?(o(),n("div",T,[c("span",K,i("coins"===e.paymentMethod?"Monedas usadas:":"Saldo usado:"),1),c("span",Q,i("coins"===e.paymentMethod?e.walletAmountUsed.toLocaleString("es-AR")+" monedas":"$"+e.walletAmountUsed.toLocaleString("es-AR")),1)])):d("",!0)]),c("div",W,[c("div",X,[c("span",Y,i(_e(e.status)),1)]),c("div",Z,["pending"===e.status?(o(),n("button",{key:0,onClick:a=>(e=>{Me.value=e,je.value=!0})(e),class:"btn-primary"},[...a[18]||(a[18]=[c("i",{class:"fas fa-credit-card mr-2"},null,-1),u(" Pagar ",-1)])],8,ee)):d("",!0),"paying"===e.status?(o(),n("button",{key:1,onClick:e=>{window.open("https://www.mercadopago.com.ar","_blank")},class:"btn-secondary"},[...a[19]||(a[19]=[c("i",{class:"fas fa-external-link-alt mr-2"},null,-1),u(" Continuar Pago ",-1)])],8,ae)):d("",!0),"delivered"===e.status?(o(),n("button",{key:2,onClick:a=>(e=>{console.log("View order details:",e)})(e),class:"btn-secondary"},[...a[20]||(a[20]=[c("i",{class:"fas fa-eye mr-2"},null,-1),u(" Ver Detalles ",-1)])],8,se)):d("",!0)])])]);var s,t,l}),128))]))])]),Ce.value?(o(),n("div",te,[c("div",le,[a[24]||(a[24]=c("h3",{class:"text-xl font-semibold mb-4"},"Cargar Saldo",-1)),c("div",re,[a[22]||(a[22]=c("label",{class:"block text-sm font-medium text-gray-400 mb-2"},"Monto a cargar",-1)),v(c("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>Ae.value=e),type:"number",min:"100",step:"100",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-craftar-500",placeholder:"Ingresa el monto"},null,512),[[b,Ae.value]])]),c("div",ne,[c("button",{onClick:a[3]||(a[3]=e=>Ce.value=!1),class:"btn-secondary"}," Cancelar "),c("button",{onClick:Re,class:"btn-primary",disabled:!Ae.value||Ae.value<100},[...a[23]||(a[23]=[c("i",{class:"fas fa-credit-card mr-2"},null,-1),u(" Cargar con MercadoPago ",-1)])],8,oe)])])])):d("",!0),je.value?(o(),n("div",ce,[c("div",de,[a[29]||(a[29]=c("h3",{class:"text-xl font-semibold mb-4"},"Procesar Pago",-1)),c("div",ie,[a[27]||(a[27]=c("p",{class:"text-gray-400 mb-4"},"Selecciona el método de pago:",-1)),c("div",ue,[c("label",me,[v(c("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>Pe.value=e),type:"radio",value:"mercadopago",class:"mr-3"},null,512),[[f,Pe.value]]),a[25]||(a[25]=c("div",null,[c("div",{class:"font-medium"},"MercadoPago"),c("div",{class:"text-sm text-gray-400"},"Pago completo con MercadoPago")],-1))]),c("label",pe,[v(c("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Pe.value=e),type:"radio",value:"wallet",class:"mr-3"},null,512),[[f,Pe.value]]),c("div",null,[a[26]||(a[26]=c("div",{class:"font-medium"},"Saldo de Cartera",-1)),c("div",ge,"Usar saldo disponible: $"+i(he.value.toLocaleString("es-AR")),1)])])])]),c("div",ye,[c("button",{onClick:a[6]||(a[6]=e=>je.value=!1),class:"btn-secondary"}," Cancelar "),c("button",{onClick:Le,class:"btn-primary",disabled:!Pe.value},[...a[28]||(a[28]=[c("i",{class:"fas fa-credit-card mr-2"},null,-1),u(" Procesar Pago ",-1)])],8,xe)])])])):d("",!0)])}}};export{ve as default};
